<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weapons Integration Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #00ff41;
            font-family: "Courier New", monospace;
        }
        #test-results {
            border: 1px solid #00ff41;
            padding: 10px;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.7);
        }
        .test-pass { color: #00ff41; }
        .test-fail { color: #ff4400; }
        .test-info { color: #ffaa00; }
        .test-section { margin: 20px 0; border-bottom: 1px solid #333; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Weapons System Integration Test</h1>
    <div id="test-results"></div>
    
    <script type="module">
        import Ship from './static/js/ship/Ship.js';
        import Weapons from './static/js/ship/systems/Weapons.js';
        
        const results = document.getElementById('test-results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-${type}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        function logSection(title) {
            const div = document.createElement('div');
            div.className = 'test-section';
            div.innerHTML = `<h3>${title}</h3>`;
            results.appendChild(div);
        }
        
        async function runTests() {
            try {
                logSection('Weapons System Integration Test');
                
                // Test 1: Create Weapons System
                log('Test 1: Creating Weapons system...');
                const weapons = new Weapons(1);
                log('✓ Weapons system created successfully', 'pass');
                log(`  - Weapon Type: ${weapons.levelStats[1].weaponType}`);
                log(`  - Base Damage: ${weapons.getCurrentDamage()}`);
                log(`  - Fire Rate: ${weapons.getCurrentFireRate()}/sec`);
                log(`  - Energy per Shot: ${weapons.getEnergyPerShot()}`);
                
                // Test 2: Create Ship and Add Weapons
                log('\nTest 2: Creating ship and adding weapons...');
                const ship = new Ship('heavy_fighter');
                const addResult = ship.addSystem('weapons', weapons);
                if (addResult) {
                    log('✓ Weapons successfully added to ship', 'pass');
                } else {
                    log('✗ Failed to add weapons to ship', 'fail');
                }
                
                // Test 3: Test Weapon Stats
                log('\nTest 3: Testing weapon statistics...');
                const status = weapons.getStatus();
                log(`  - Current Damage: ${status.currentDamage}`);
                log(`  - Current Fire Rate: ${status.currentFireRate}/sec`);
                log(`  - Energy per Shot: ${status.energyPerShot}`);
                log(`  - Can Fire: ${status.canFire}`);
                log(`  - System Health: ${status.healthPercentage * 100}%`);
                
                // Test 4: Test Firing
                log('\nTest 4: Testing weapon firing...');
                const initialEnergy = ship.currentEnergy;
                log(`  - Initial Energy: ${initialEnergy}`);
                
                const fireResult = weapons.fire(ship);
                if (fireResult) {
                    log('✓ Weapon fired successfully', 'pass');
                    log(`  - Damage Dealt: ${fireResult.damage}`);
                    log(`  - Energy Consumed: ${fireResult.energyConsumed}`);
                    log(`  - Hit Result: ${fireResult.hit ? 'HIT' : 'MISS'}`);
                    log(`  - Weapon Type: ${fireResult.weaponType}`);
                    log(`  - Ship Energy After: ${ship.currentEnergy}`);
                } else {
                    log('✗ Weapon failed to fire', 'fail');
                }
                
                // Test 5: Test Fire Rate Limiting
                log('\nTest 5: Testing fire rate limiting...');
                const secondFireResult = weapons.fire(ship);
                if (!secondFireResult) {
                    log('✓ Fire rate limiting working correctly', 'pass');
                    log(`  - Cooldown remaining: ${weapons.currentCooldown}ms`);
                } else {
                    log('✗ Fire rate limiting not working', 'fail');
                }
                
                // Test 6: Test Level Progression
                log('\nTest 6: Testing level progression...');
                for (let level = 2; level <= 5; level++) {
                    const upgradeResult = weapons.upgrade();
                    if (upgradeResult) {
                        const levelStatus = weapons.getStatus();
                        log(`  - Level ${level}: ${levelStatus.weaponType}`);
                        log(`    Damage: ${levelStatus.currentDamage}, Fire Rate: ${levelStatus.currentFireRate}/sec`);
                    }
                }
                
                // Test 7: Test Damage Effects
                log('\nTest 7: Testing damage effects...');
                weapons.takeDamage(50);
                const damagedStatus = weapons.getStatus();
                log(`  - After 50% damage: Health ${(damagedStatus.healthPercentage * 100).toFixed(1)}%`);
                log(`  - Damage output: ${damagedStatus.currentDamage.toFixed(1)} (reduced from max)`);
                log(`  - Energy efficiency: ${damagedStatus.energyPerShot.toFixed(1)} (increased consumption)`);
                
                // Test 8: Test Ship Integration
                log('\nTest 8: Testing ship integration...');
                const shipStatus = ship.getStatus();
                if (shipStatus.systems && shipStatus.systems.weapons) {
                    log('✓ Weapons properly integrated with ship', 'pass');
                    log(`  - System Health: ${(shipStatus.systems.weapons.health * 100).toFixed(1)}%`);
                    log(`  - System Active: ${shipStatus.systems.weapons.isActive}`);
                } else {
                    log('✗ Weapons not properly integrated with ship', 'fail');
                }
                
                logSection('Test Complete');
                log('All tests completed. Check console for detailed ship status.', 'info');
                log('Try: weapons.fire(ship) to test firing manually.', 'info');
                log('Try: ship.getStatus() to see current ship state.', 'info');
                
                // Make objects available in console
                window.testShip = ship;
                window.testWeapons = weapons;
                console.log('Test objects available:', { ship, weapons });
                
            } catch (error) {
                log(`✗ Test failed with error: ${error.message}`, 'fail');
                console.error('Test error:', error);
            }
        }
        
        runTests();
    </script>
</body>
</html> 