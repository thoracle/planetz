<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Armor Card Drag Debug Test</title>
    <link rel="stylesheet" href="css/card-inventory.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .debug-info {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .debug-info h2 {
            color: #4CAF50;
            margin-top: 0;
        }
        .debug-log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .test-cards {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .test-card {
            background: #3a3a3a;
            border: 2px solid #555;
            border-radius: 8px;
            padding: 15px;
            cursor: grab;
            min-width: 150px;
        }
        .test-card:active {
            cursor: grabbing;
        }
        .test-card.dragging {
            opacity: 0.5;
        }
        .test-slots {
            display: flex;
            gap: 20px;
        }
        .test-slot {
            background: #444;
            border: 2px dashed #666;
            border-radius: 8px;
            padding: 20px;
            min-width: 150px;
            min-height: 100px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .test-slot.valid-drop {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        .test-slot.invalid-drop {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <div class="debug-info">
            <h2>üîß Armor Card Drag Debug Test</h2>
            <p>This test specifically checks Phase Shield and Adaptive Armor drag functionality.</p>
            <div id="debug-log" class="debug-log"></div>
        </div>

        <div class="test-section">
            <h3>Test Cards (Try dragging these to armor slots)</h3>
            <div class="test-cards">
                <div class="test-card" id="phase-shield-card">
                    <div class="card-header">
                        <span class="card-icon">üõ°Ô∏è</span>
                        <span class="card-name">Phase Shield</span>
                    </div>
                    <div class="card-rarity">RARE</div>
                    <div class="card-type">phase_shield</div>
                </div>
                
                <div class="test-card" id="adaptive-armor-card">
                    <div class="card-header">
                        <span class="card-icon">üõ°Ô∏è</span>
                        <span class="card-name">Adaptive Armor</span>
                    </div>
                    <div class="card-rarity">EPIC</div>
                    <div class="card-type">adaptive_armor</div>
                </div>
                
                <div class="test-card" id="laser-cannon-card">
                    <div class="card-header">
                        <span class="card-icon">‚öîÔ∏è</span>
                        <span class="card-name">Laser Cannon</span>
                    </div>
                    <div class="card-rarity">COMMON</div>
                    <div class="card-type">laser_cannon</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>Test Slots</h3>
            <div class="test-slots">
                <div class="test-slot" data-slot-type="armor" data-slot-id="armor_1">
                    <div>Armor Slot<br><small>Should accept Phase Shield & Adaptive Armor</small></div>
                </div>
                
                <div class="test-slot" data-slot-type="weapon" data-slot-id="weapon_1">
                    <div>Weapon Slot<br><small>Should accept Laser Cannon</small></div>
                </div>
                
                <div class="test-slot" data-slot-type="engine" data-slot-id="engine_1">
                    <div>Engine Slot<br><small>Should reject all test cards</small></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { CARD_TYPES } from './js/ship/NFTCard.js';
        import NFTCard from './js/ship/NFTCard.js';

        // Debug logging function
        function debugLog(message) {
            const logElement = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        // Create test card data
        const testCards = {
            'phase-shield-card': new NFTCard(CARD_TYPES.PHASE_SHIELD, 'rare'),
            'adaptive-armor-card': new NFTCard(CARD_TYPES.ADAPTIVE_ARMOR, 'epic'),
            'laser-cannon-card': new NFTCard(CARD_TYPES.LASER_CANNON, 'common')
        };

        // Slot compatibility (copied from CardInventoryUI)
        const slotCompatibility = {
            'armor': [
                CARD_TYPES.HULL_PLATING,
                CARD_TYPES.PHASE_SHIELD, 
                CARD_TYPES.ADAPTIVE_ARMOR, 
                CARD_TYPES.QUANTUM_BARRIER, 
                CARD_TYPES.TEMPORAL_DEFLECTOR
            ],
            'weapon': [
                CARD_TYPES.LASER_CANNON, 
                CARD_TYPES.PLASMA_CANNON, 
                CARD_TYPES.PULSE_CANNON,
                CARD_TYPES.PHASER_ARRAY, 
                CARD_TYPES.DISRUPTOR_CANNON, 
                CARD_TYPES.PARTICLE_BEAM,
                CARD_TYPES.MISSILE_TUBES, 
                CARD_TYPES.TORPEDO_LAUNCHER
            ],
            'engine': [
                CARD_TYPES.IMPULSE_ENGINES, 
                CARD_TYPES.WARP_DRIVE,
                CARD_TYPES.QUANTUM_DRIVE, 
                CARD_TYPES.DIMENSIONAL_SHIFTER, 
                CARD_TYPES.TEMPORAL_ENGINE, 
                CARD_TYPES.GRAVITY_WELL_DRIVE
            ]
        };

        function isValidCardForSlot(card, slotType) {
            const compatibleTypes = slotCompatibility[slotType] || [];
            const isValid = compatibleTypes.includes(card.cardType);
            debugLog(`Checking ${card.metadata.name} (${card.cardType}) for ${slotType} slot: ${isValid ? 'VALID' : 'INVALID'}`);
            debugLog(`Compatible types for ${slotType}: ${compatibleTypes.join(', ')}`);
            return isValid;
        }

        let draggedCard = null;

        // Setup drag and drop for test cards
        Object.entries(testCards).forEach(([elementId, cardData]) => {
            const element = document.getElementById(elementId);
            
            debugLog(`Setting up drag for ${cardData.metadata.name} (${cardData.cardType})`);
            
            element.draggable = true;
            
            element.addEventListener('dragstart', (e) => {
                draggedCard = cardData;
                element.classList.add('dragging');
                debugLog(`Drag started: ${cardData.metadata.name}`);
                e.dataTransfer.setData('text/plain', JSON.stringify(cardData));
                e.dataTransfer.effectAllowed = 'move';
            });

            element.addEventListener('dragend', (e) => {
                element.classList.remove('dragging');
                debugLog(`Drag ended: ${cardData.metadata.name}`);
                
                // Clear slot highlights
                document.querySelectorAll('.test-slot').forEach(slot => {
                    slot.classList.remove('valid-drop', 'invalid-drop');
                });
            });
        });

        // Setup drop zones
        document.querySelectorAll('.test-slot').forEach(slot => {
            slot.addEventListener('dragover', (e) => {
                e.preventDefault();
                
                if (!draggedCard) return;
                
                const slotType = slot.dataset.slotType;
                const isValid = isValidCardForSlot(draggedCard, slotType);
                
                slot.classList.toggle('valid-drop', isValid);
                slot.classList.toggle('invalid-drop', !isValid);
                
                e.dataTransfer.dropEffect = isValid ? 'move' : 'none';
            });

            slot.addEventListener('dragleave', (e) => {
                slot.classList.remove('valid-drop', 'invalid-drop');
            });

            slot.addEventListener('drop', (e) => {
                e.preventDefault();
                
                const slotType = slot.dataset.slotType;
                const slotId = slot.dataset.slotId;
                
                slot.classList.remove('valid-drop', 'invalid-drop');
                
                if (!draggedCard) {
                    debugLog('No dragged card found during drop');
                    return;
                }
                
                const isValid = isValidCardForSlot(draggedCard, slotType);
                
                if (isValid) {
                    debugLog(`‚úÖ Successfully dropped ${draggedCard.metadata.name} in ${slotType} slot`);
                    slot.innerHTML = `
                        <div>
                            <strong>${draggedCard.metadata.name}</strong><br>
                            <small>Installed in ${slotType} slot</small>
                        </div>
                    `;
                } else {
                    debugLog(`‚ùå Cannot drop ${draggedCard.metadata.name} in ${slotType} slot`);
                }
                
                draggedCard = null;
            });
        });

        debugLog('Debug test initialized. Try dragging the cards to different slots.');
        debugLog(`Phase Shield card type: ${CARD_TYPES.PHASE_SHIELD}`);
        debugLog(`Adaptive Armor card type: ${CARD_TYPES.ADAPTIVE_ARMOR}`);
        debugLog(`Armor slot compatible types: ${slotCompatibility.armor.join(', ')}`);
    </script>
</body>
</html> 