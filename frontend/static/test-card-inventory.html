<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Inventory System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 5px;
            background-color: #2a2a2a;
        }
        .card-stack {
            display: inline-block;
            margin: 5px;
            padding: 10px;
            border: 2px solid;
            border-radius: 8px;
            background-color: #333;
            min-width: 150px;
            text-align: center;
        }
        .card-stack.discovered {
            border-color: #4CAF50;
        }
        .card-stack.undiscovered {
            border-color: #666;
            opacity: 0.5;
        }
        .card-stack.can-upgrade {
            border-color: #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        .rarity-common { background-color: #666; }
        .rarity-rare { background-color: #4169E1; }
        .rarity-epic { background-color: #9932CC; }
        .rarity-legendary { background-color: #FF8C00; }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #444;
            border-radius: 5px;
            margin: 5px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-card {
            background-color: #333;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #555;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        
        .pack-opening {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .card-reveal {
            display: inline-block;
            margin: 10px;
            padding: 15px;
            border-radius: 8px;
            min-width: 120px;
            text-align: center;
            animation: cardReveal 0.5s ease-in-out;
        }
        
        @keyframes cardReveal {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .new-discovery {
            border: 3px solid #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .log {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üÉè Card Inventory System Test</h1>
    
    <div class="test-section">
        <h2>üìä Collection Statistics</h2>
        <div id="stats-display" class="stats-grid">
            <!-- Stats will be populated here -->
        </div>
    </div>
    
    <div class="test-section">
        <h2>üéÅ Card Pack Opening</h2>
        <button onclick="openCardPack(1)">Open Single Card</button>
        <button onclick="openCardPack(5)">Open 5-Card Pack</button>
        <button onclick="openCardPack(10)">Open 10-Card Pack</button>
        <button onclick="addSpecificCard()">Add Specific Card</button>
        <button onclick="resetInventory()">Reset Inventory</button>
        
        <div id="pack-results" class="pack-opening">
            <!-- Pack opening results will appear here -->
        </div>
    </div>
    
    <div class="test-section">
        <h2>üóÇÔ∏è Card Collection</h2>
        <div>
            <button onclick="showDiscovered()">Show Discovered</button>
            <button onclick="showUndiscovered()">Show Undiscovered</button>
            <button onclick="showAll()">Show All</button>
        </div>
        <div id="card-collection">
            <!-- Card stacks will be displayed here -->
        </div>
    </div>
    
    <div class="test-section">
        <h2>üìù Activity Log</h2>
        <div id="activity-log" class="log">
            <!-- Activity log will appear here -->
        </div>
    </div>

    <script type="module">
        import CardInventory from './js/ship/CardInventory.js';
        import NFTCard, { CARD_TYPES, CARD_RARITY } from './js/ship/NFTCard.js';

        // Global inventory instance
        window.inventory = new CardInventory();
        
        // Activity log
        function log(message) {
            const logElement = document.getElementById('activity-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}<br>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // Update statistics display
        function updateStats() {
            const stats = window.inventory.getCollectionStats();
            const statsDisplay = document.getElementById('stats-display');
            
            statsDisplay.innerHTML = `
                <div class="stat-card">
                    <h3>üìà Collection Progress</h3>
                    <p>Discovered: ${stats.discoveredCardTypes}/${stats.totalCardTypes}</p>
                    <p>Completion: ${stats.completionPercentage}%</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${stats.completionPercentage}%"></div>
                    </div>
                </div>
                <div class="stat-card">
                    <h3>üÉè Total Cards</h3>
                    <p>Cards Collected: ${stats.totalCardsCollected}</p>
                </div>
                <div class="stat-card">
                    <h3>‚ú® Rarity Distribution</h3>
                    ${Object.entries(stats.rarityStats).map(([rarity, data]) => 
                        `<p>${rarity}: ${data.discovered}/${data.total}</p>`
                    ).join('')}
                </div>
            `;
        }
        
        // Display card collection
        function displayCards(cards) {
            const collectionElement = document.getElementById('card-collection');
            
            collectionElement.innerHTML = cards.map(stack => {
                const classes = ['card-stack'];
                if (stack.discovered) classes.push('discovered');
                else classes.push('undiscovered');
                if (stack.canUpgrade) classes.push('can-upgrade');
                
                const card = new NFTCard(stack.cardType);
                classes.push(`rarity-${card.rarity}`);
                
                return `
                    <div class="${classes.join(' ')}" onclick="handleCardClick('${stack.cardType}')">
                        <h4>${stack.discovered ? card.getDisplayName() : '???'}</h4>
                        ${stack.discovered ? `
                            <p>Level: ${stack.level}</p>
                            <p>Count: ${stack.count}</p>
                            ${stack.nextLevelRequirement ? `
                                <p>Next: ${stack.nextLevelRequirement}</p>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${stack.progressToNextLevel * 100}%"></div>
                                </div>
                            ` : '<p>MAX LEVEL</p>'}
                            ${stack.canUpgrade ? '<p>üî• CAN UPGRADE!</p>' : ''}
                        ` : '<p>Undiscovered</p>'}
                    </div>
                `;
            }).join('');
        }
        
        // Handle card click (upgrade if possible)
        window.handleCardClick = function(cardType) {
            const stack = window.inventory.getCardStack(cardType);
            if (stack && stack.canUpgrade) {
                const result = window.inventory.upgradeCard(cardType);
                if (result.success) {
                    log(`üî• Upgraded ${cardType} to level ${result.newLevel}! Used ${result.cardsUsed} cards.`);
                    updateDisplay();
                } else {
                    log(`‚ùå Failed to upgrade ${cardType}: ${result.error}`);
                }
            }
        };
        
        // Open card pack
        window.openCardPack = function(size) {
            const packResult = window.inventory.openCardPack(size);
            const resultsElement = document.getElementById('pack-results');
            
            let html = `<h3>üéÅ Opened ${size}-card pack!</h3>`;
            
            packResult.cards.forEach((cardResult, index) => {
                const card = cardResult.card;
                const result = cardResult.result;
                
                const classes = ['card-reveal', `rarity-${card.rarity}`];
                if (result.discovered) classes.push('new-discovery');
                
                html += `
                    <div class="${classes.join(' ')}">
                        <h4>${card.getDisplayName()}</h4>
                        <p>${card.rarity.toUpperCase()}</p>
                        ${result.discovered ? '<p>üÜï NEW!</p>' : ''}
                        ${result.autoUpgraded ? `<p>‚¨ÜÔ∏è Level ${result.newLevel}!</p>` : ''}
                    </div>
                `;
                
                // Log the card
                const logMsg = `üÉè Got ${card.getDisplayName()} (${card.rarity})${result.discovered ? ' - NEW DISCOVERY!' : ''}${result.autoUpgraded ? ` - AUTO UPGRADED to level ${result.newLevel}!` : ''}`;
                log(logMsg);
            });
            
            resultsElement.innerHTML = html;
            updateDisplay();
        };
        
        // Add specific card for testing
        window.addSpecificCard = function() {
            const cardTypes = Object.values(CARD_TYPES);
            const randomType = cardTypes[Math.floor(Math.random() * cardTypes.length)];
            const rarities = Object.values(CARD_RARITY);
            const randomRarity = rarities[Math.floor(Math.random() * rarities.length)];
            
            const card = new NFTCard(randomType, randomRarity);
            const result = window.inventory.addCard(card);
            
            log(`üéØ Added specific card: ${card.getDisplayName()} (${card.rarity})`);
            updateDisplay();
        };
        
        // Reset inventory
        window.resetInventory = function() {
            window.inventory.reset();
            log('üîÑ Inventory reset!');
            updateDisplay();
        };
        
        // Show different card views
        window.showDiscovered = function() {
            displayCards(window.inventory.getDiscoveredCards());
        };
        
        window.showUndiscovered = function() {
            displayCards(window.inventory.getUndiscoveredCards());
        };
        
        window.showAll = function() {
            displayCards(window.inventory.getAllCardStacks());
        };
        
        // Update entire display
        function updateDisplay() {
            updateStats();
            showAll(); // Default to showing all cards
        }
        
        // Initialize display
        log('üöÄ Card Inventory System initialized!');
        updateDisplay();
        
        // Auto-open a starter pack for demonstration
        setTimeout(() => {
            log('üéÅ Opening starter pack...');
            openCardPack(5);
        }, 1000);
    </script>
</body>
</html> 