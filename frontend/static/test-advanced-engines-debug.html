<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Engines Debug Test</title>
    <link rel="stylesheet" href="css/card-inventory.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .debug-info {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .debug-info h2 {
            color: #4CAF50;
            margin-top: 0;
        }
        .test-section {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .card-test {
            display: inline-block;
            margin: 10px;
            padding: 10px;
            background: #444;
            border-radius: 5px;
            border: 2px solid #666;
            cursor: grab;
        }
        .card-test:hover {
            border-color: #4CAF50;
        }
        .card-test.dragging {
            opacity: 0.5;
        }
        .engine-slot {
            width: 200px;
            height: 100px;
            border: 2px dashed #666;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px;
            background: #2a2a2a;
        }
        .engine-slot.valid-drop {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        .engine-slot.invalid-drop {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }
        .debug-log {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #444;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <div class="debug-info">
            <h2>🔧 Advanced Engines Debug Test</h2>
            <p>This test specifically checks why advanced engine cards (Quantum Drive, Dimensional Shifter, etc.) can't be dragged while basic engines work.</p>
            
            <div class="test-section">
                <h3>Engine Cards Test</h3>
                <div id="engine-cards-container"></div>
            </div>
            
            <div class="test-section">
                <h3>Engine Slot</h3>
                <div class="engine-slot" data-slot-type="engine" data-slot-id="engine_test">
                    Drop Engine Here
                </div>
            </div>
            
            <div class="test-section">
                <h3>Debug Log</h3>
                <div id="debug-log" class="debug-log"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { CARD_TYPES, CARD_RARITY } from './js/ship/NFTCard.js';
        import NFTCard from './js/ship/NFTCard.js';
        import CardInventory from './js/ship/CardInventory.js';

        // Debug logging function
        function debugLog(message) {
            const logElement = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}<br>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        // Test engine types
        const engineTypes = [
            CARD_TYPES.IMPULSE_ENGINES,
            CARD_TYPES.WARP_DRIVE,
            CARD_TYPES.QUANTUM_DRIVE,
            CARD_TYPES.DIMENSIONAL_SHIFTER,
            CARD_TYPES.TEMPORAL_ENGINE,
            CARD_TYPES.GRAVITY_WELL_DRIVE
        ];

        // Create test cards
        const testCards = [];
        engineTypes.forEach(engineType => {
            try {
                const card = new NFTCard(engineType, CARD_RARITY.COMMON);
                testCards.push(card);
                debugLog(`✅ Created card: ${card.metadata.name} (${engineType})`);
            } catch (error) {
                debugLog(`❌ Failed to create card for ${engineType}: ${error.message}`);
            }
        });

        // Render test cards
        const cardsContainer = document.getElementById('engine-cards-container');
        testCards.forEach(card => {
            const cardElement = document.createElement('div');
            cardElement.className = 'card-test';
            cardElement.innerHTML = `
                <div><strong>${card.metadata.name}</strong></div>
                <div>Type: ${card.cardType}</div>
                <div>Rarity: ${card.rarity}</div>
            `;
            
            // Test drag setup
            try {
                setupCardDrag(cardElement, card);
                debugLog(`✅ Drag setup successful for ${card.metadata.name}`);
            } catch (error) {
                debugLog(`❌ Drag setup failed for ${card.metadata.name}: ${error.message}`);
            }
            
            cardsContainer.appendChild(cardElement);
        });

        // Simplified drag setup function
        function setupCardDrag(cardElement, cardData) {
            cardElement.draggable = true;
            
            cardElement.addEventListener('dragstart', (e) => {
                debugLog(`🚀 Drag started: ${cardData.metadata.name} (${cardData.cardType})`);
                cardElement.classList.add('dragging');
                
                // Test card validation
                const isValidForEngine = isValidCardForSlot(cardData, 'engine');
                debugLog(`🔍 Card validation for engine slot: ${isValidForEngine ? 'VALID' : 'INVALID'}`);
                
                e.dataTransfer.setData('text/plain', JSON.stringify(cardData));
                e.dataTransfer.effectAllowed = 'move';
            });

            cardElement.addEventListener('dragend', (e) => {
                debugLog(`🏁 Drag ended: ${cardData.metadata.name}`);
                cardElement.classList.remove('dragging');
            });
        }

        // Simplified validation function
        function isValidCardForSlot(card, slotType) {
            const engineCompatibleTypes = [
                CARD_TYPES.IMPULSE_ENGINES, 
                CARD_TYPES.WARP_DRIVE,
                CARD_TYPES.QUANTUM_DRIVE, 
                CARD_TYPES.DIMENSIONAL_SHIFTER, 
                CARD_TYPES.TEMPORAL_ENGINE, 
                CARD_TYPES.GRAVITY_WELL_DRIVE
            ];
            
            if (slotType === 'engine') {
                const isValid = engineCompatibleTypes.includes(card.cardType);
                debugLog(`🔍 Checking ${card.metadata.name} (${card.cardType}) for engine slot: ${isValid ? 'VALID' : 'INVALID'}`);
                debugLog(`🔍 Compatible types: ${engineCompatibleTypes.join(', ')}`);
                return isValid;
            }
            
            return false;
        }

        // Setup drop zone
        const engineSlot = document.querySelector('.engine-slot');
        
        engineSlot.addEventListener('dragover', (e) => {
            e.preventDefault();
            
            try {
                const cardData = JSON.parse(e.dataTransfer.getData('text/plain'));
                const isValid = isValidCardForSlot(cardData, 'engine');
                
                engineSlot.classList.toggle('valid-drop', isValid);
                engineSlot.classList.toggle('invalid-drop', !isValid);
                
                e.dataTransfer.dropEffect = isValid ? 'move' : 'none';
            } catch (error) {
                debugLog(`❌ Error in dragover: ${error.message}`);
            }
        });

        engineSlot.addEventListener('drop', (e) => {
            e.preventDefault();
            
            try {
                const cardData = JSON.parse(e.dataTransfer.getData('text/plain'));
                debugLog(`📦 Drop attempted: ${cardData.metadata.name} (${cardData.cardType})`);
                
                const isValid = isValidCardForSlot(cardData, 'engine');
                if (isValid) {
                    engineSlot.innerHTML = `✅ ${cardData.metadata.name} installed!`;
                    debugLog(`✅ Successfully installed ${cardData.metadata.name}`);
                } else {
                    debugLog(`❌ Invalid drop: ${cardData.metadata.name} not compatible with engine slot`);
                }
            } catch (error) {
                debugLog(`❌ Error in drop: ${error.message}`);
            }
            
            engineSlot.classList.remove('valid-drop', 'invalid-drop');
        });

        engineSlot.addEventListener('dragleave', (e) => {
            engineSlot.classList.remove('valid-drop', 'invalid-drop');
        });

        debugLog('🎯 Advanced Engines Debug Test initialized');
        debugLog(`📊 Created ${testCards.length} test cards`);
        debugLog('🎮 Try dragging the cards to the engine slot');
    </script>
</body>
</html> 