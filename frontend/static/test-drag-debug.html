<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag & Drop Debug Test - Planetz</title>
    <link rel="stylesheet" href="css/card-inventory.css">
    <style>
        body {
            background: #0a0a0a;
            margin: 0;
            padding: 20px;
            font-family: 'Orbitron', monospace;
        }
        
        .debug-info {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            color: #ffffff;
        }
        
        .debug-info h3 {
            color: #00ffff;
            margin-top: 0;
        }
        
        .debug-log {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 5px;
            padding: 10px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            color: #00ff00;
        }
        
        .debug-controls {
            margin: 20px 0;
        }
        
        .debug-controls button {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid rgba(0, 255, 255, 0.5);
            color: #00ffff;
            padding: 8px 16px;
            margin-right: 10px;
            border-radius: 3px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
        }
        
        .debug-controls button:hover {
            background: rgba(0, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="debug-info">
        <h3>üêõ Drag & Drop Debug Test</h3>
        <p>This page helps debug drag and drop issues with enhanced logging and error reporting.</p>
        <ul>
            <li><strong>Console Logging:</strong> All drag events are logged to console</li>
            <li><strong>Error Handling:</strong> Improved error handling with user feedback</li>
            <li><strong>Validation:</strong> Card data validation before drag setup</li>
            <li><strong>State Tracking:</strong> Better tracking of drag state</li>
        </ul>
    </div>

    <div class="debug-controls">
        <button onclick="clearDebugLog()">Clear Log</button>
        <button onclick="testDragSetup()">Test Drag Setup</button>
        <button onclick="validateAllCards()">Validate All Cards</button>
        <button onclick="resetInventory()">Reset Inventory</button>
    </div>

    <div id="card-inventory-container"></div>

    <div class="debug-log" id="debug-log">
        <div>Debug log initialized...</div>
    </div>

    <script type="module">
        import CardInventoryUI from './js/ui/CardInventoryUI.js';

        // Enhanced logging for debugging
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        function addToDebugLog(message, type = 'log') {
            const debugLog = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? '#ff4444' : type === 'warn' ? '#ffaa00' : '#00ff00';
            logEntry.textContent = `[${timestamp}] ${message}`;
            debugLog.appendChild(logEntry);
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addToDebugLog(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            addToDebugLog('WARN: ' + args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addToDebugLog('ERROR: ' + args.join(' '), 'error');
        };

        // Initialize the card inventory UI
        const cardInventoryUI = new CardInventoryUI('card-inventory-container');
        window.cardInventoryUI = cardInventoryUI;

        // Load test data
        cardInventoryUI.loadTestData();
        cardInventoryUI.render();

        // Debug functions
        window.clearDebugLog = function() {
            document.getElementById('debug-log').innerHTML = '<div>Debug log cleared...</div>';
        };

        window.testDragSetup = function() {
            console.log('Testing drag setup for all cards...');
            const cardElements = document.querySelectorAll('.card-stack');
            console.log(`Found ${cardElements.length} card elements`);
            
            cardElements.forEach((element, index) => {
                const cardType = element.dataset.cardType;
                const cardData = cardInventoryUI.inventory.getCardStack(cardType);
                console.log(`Card ${index + 1}: ${cardType}, draggable: ${element.draggable}, data valid: ${!!cardData}`);
            });
        };

        window.validateAllCards = function() {
            console.log('Validating all card data...');
            const stacks = cardInventoryUI.inventory.getAllCardStacks();
            
            stacks.forEach((stack, index) => {
                const validation = cardInventoryUI.validateCardData(stack.sampleCard);
                if (!validation.valid) {
                    console.error(`Card ${index + 1} validation failed: ${validation.error}`, stack);
                } else {
                    console.log(`Card ${index + 1} (${stack.name}) validation passed`);
                }
            });
        };

        window.resetInventory = function() {
            console.log('Resetting inventory...');
            cardInventoryUI.loadTestData();
            cardInventoryUI.render();
        };

        console.log('üöÄ Drag & Drop Debug Test initialized');
        console.log('üìã Features enabled:');
        console.log('  ‚Ä¢ Enhanced error handling');
        console.log('  ‚Ä¢ Card data validation');
        console.log('  ‚Ä¢ Improved state tracking');
        console.log('  ‚Ä¢ Detailed logging');
    </script>
</body>
</html> 