<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Weapons Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #00ff41;
            font-family: "Courier New", monospace;
        }
        #test-panel {
            border: 1px solid #00ff41;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.8);
        }
        .status-good { color: #00ff41; }
        .status-warning { color: #ffaa00; }
        .status-error { color: #ff4400; }
        .test-section { margin: 15px 0; border-left: 3px solid #333; padding-left: 10px; }
        #live-log {
            border: 1px solid #333;
            padding: 10px;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.5);
            font-family: monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
        }
        button {
            background: #003300;
            color: #00ff41;
            border: 1px solid #00ff41;
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
            font-family: "Courier New", monospace;
        }
        button:hover { background: #004400; }
        button:disabled {
            background: #111;
            color: #666;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>Simple Weapons Test (No Module Dependencies)</h1>
    
    <div id="test-panel">
        <h3>Weapon Firing Test</h3>
        
        <div class="test-section">
            <strong>Current Status:</strong>
            <div id="weapon-status">Initializing...</div>
        </div>
        
        <div style="margin: 20px 0;">
            <button id="fire-btn">üî´ Fire Weapon (Spacebar)</button>
            <button id="reset-btn">‚è∞ Reset Cooldown</button>
            <button id="fast-fire-btn">‚ö° Enable Fast Fire (Test Mode)</button>
        </div>
        
        <div class="test-section">
            <strong>Live Fire Log:</strong>
            <div id="live-log"></div>
        </div>
    </div>

    <div style="margin-top: 20px; padding: 10px; border: 1px solid #333;">
        <h4>Instructions:</h4>
        <ul>
            <li>Press <strong>SPACEBAR</strong> or click Fire button to test weapons</li>
            <li>Normal fire rate: 2 shots/second (500ms cooldown)</li>
            <li>Watch the timing and energy consumption</li>
            <li>Use "Enable Fast Fire" to remove cooldown for rapid testing</li>
        </ul>
    </div>
    
    <script>
        // Simple mock weapon system for testing
        class SimpleWeapon {
            constructor() {
                this.damage = 50;
                this.fireRate = 2.0; // shots per second
                this.energyPerShot = 15;
                this.lastFireTime = 0;
                this.health = 100;
                this.fastFireMode = false;
            }
            
            getShotCooldown() {
                return this.fastFireMode ? 0 : 1000 / this.fireRate;
            }
            
            canFire() {
                if (this.health <= 0) return false;
                const now = Date.now();
                const cooldown = this.getShotCooldown();
                return (now - this.lastFireTime) >= cooldown;
            }
            
            fire(ship) {
                if (!this.canFire()) {
                    return null;
                }
                
                if (ship.energy < this.energyPerShot) {
                    return null;
                }
                
                // Consume energy
                ship.energy -= this.energyPerShot;
                
                // Update fire time
                this.lastFireTime = Date.now();
                
                return {
                    damage: this.damage,
                    energyConsumed: this.energyPerShot,
                    hit: Math.random() > 0.1, // 90% hit chance
                    timestamp: this.lastFireTime
                };
            }
            
            getRemainingCooldown() {
                const now = Date.now();
                const cooldown = this.getShotCooldown();
                const elapsed = now - this.lastFireTime;
                return Math.max(0, cooldown - elapsed);
            }
        }
        
        // Simple mock ship
        class SimpleShip {
            constructor() {
                this.energy = 1000;
                this.maxEnergy = 1000;
            }
        }
        
        // Initialize test objects
        const weapon = new SimpleWeapon();
        const ship = new SimpleShip();
        
        // UI elements
        const weaponStatus = document.getElementById('weapon-status');
        const liveLog = document.getElementById('live-log');
        const fireBtn = document.getElementById('fire-btn');
        const resetBtn = document.getElementById('reset-btn');
        const fastFireBtn = document.getElementById('fast-fire-btn');
        
        // Test statistics
        let fireAttempts = 0;
        let successfulFires = 0;
        let lastLogTime = 0;
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? '#00ff41' : 
                         type === 'error' ? '#ff4400' : 
                         type === 'warning' ? '#ffaa00' : '#ffffff';
            
            const div = document.createElement('div');
            div.style.color = color;
            div.innerHTML = `[${timestamp}] ${message}`;
            
            liveLog.appendChild(div);
            
            // Keep only last 15 messages
            while (liveLog.children.length > 15) {
                liveLog.removeChild(liveLog.firstChild);
            }
            
            liveLog.scrollTop = liveLog.scrollHeight;
        }
        
        function updateStatus() {
            const canFire = weapon.canFire();
            const hasEnergy = ship.energy >= weapon.energyPerShot;
            const cooldownRemaining = weapon.getRemainingCooldown();
            
            weaponStatus.innerHTML = `
                <div>Can Fire: <span class="${canFire ? 'status-good' : 'status-error'}">${canFire ? 'YES' : 'NO'}</span></div>
                <div>Ship Energy: <span class="${hasEnergy ? 'status-good' : 'status-error'}">${ship.energy.toFixed(1)}/${ship.maxEnergy}</span></div>
                <div>Cooldown: <span class="${cooldownRemaining <= 0 ? 'status-good' : 'status-warning'}">${cooldownRemaining.toFixed(0)}ms</span></div>
                <div>Fire Rate: <span class="status-good">${weapon.fireRate}/sec</span> | 
                     Energy/Shot: <span class="status-good">${weapon.energyPerShot}</span></div>
                <div>Test Stats: <span class="status-good">${successfulFires}/${fireAttempts} successful</span> 
                     (${fireAttempts > 0 ? ((successfulFires / fireAttempts) * 100).toFixed(1) : 0}%)</div>
                <div>Fast Fire Mode: <span class="${weapon.fastFireMode ? 'status-warning' : 'status-good'}">${weapon.fastFireMode ? 'ON' : 'OFF'}</span></div>
            `;
            
            // Update fire button
            fireBtn.disabled = !canFire || !hasEnergy;
            if (!hasEnergy) {
                fireBtn.textContent = 'üî´ Fire Weapon (No Energy)';
            } else if (!canFire) {
                fireBtn.textContent = `üî´ Fire Weapon (Cooldown: ${cooldownRemaining.toFixed(0)}ms)`;
            } else {
                fireBtn.textContent = 'üî´ Fire Weapon (Ready)';
            }
        }
        
        function attemptFire() {
            fireAttempts++;
            const now = Date.now();
            const timeSinceLastLog = now - lastLogTime;
            
            // Only log timing if it's been less than 2 seconds since last fire
            if (timeSinceLastLog < 2000) {
                log(`Fire attempt #${fireAttempts} (${timeSinceLastLog}ms since last)`);
            } else {
                log(`Fire attempt #${fireAttempts}`);
            }
            
            if (!weapon.canFire()) {
                const cooldown = weapon.getRemainingCooldown();
                log(`‚ùå FAILED: Weapon on cooldown (${cooldown.toFixed(0)}ms remaining)`, 'error');
                updateStatus();
                return;
            }
            
            if (ship.energy < weapon.energyPerShot) {
                log('‚ùå FAILED: Insufficient energy', 'error');
                updateStatus();
                return;
            }
            
            const fireResult = weapon.fire(ship);
            if (fireResult) {
                successfulFires++;
                log(`‚úÖ SUCCESS: Fired! Damage: ${fireResult.damage}, Energy: ${fireResult.energyConsumed}`, 'success');
                log(`üéØ ${fireResult.hit ? 'HIT' : 'MISS'} - Ship energy now: ${ship.energy.toFixed(1)}`, fireResult.hit ? 'success' : 'warning');
                lastLogTime = now;
            } else {
                log('‚ùå FAILED: Unknown error', 'error');
            }
            
            updateStatus();
        }
        
        // Event listeners
        fireBtn.addEventListener('click', attemptFire);
        
        resetBtn.addEventListener('click', () => {
            weapon.lastFireTime = 0;
            log('üîÑ Cooldown reset', 'info');
            updateStatus();
        });
        
        fastFireBtn.addEventListener('click', () => {
            weapon.fastFireMode = !weapon.fastFireMode;
            if (weapon.fastFireMode) {
                log('‚ö° Fast fire mode ENABLED (no cooldown)', 'warning');
                fastFireBtn.textContent = 'üêå Disable Fast Fire';
            } else {
                log('üêå Fast fire mode DISABLED (normal cooldown)', 'info');
                fastFireBtn.textContent = '‚ö° Enable Fast Fire (Test Mode)';
            }
            updateStatus();
        });
        
        // Keyboard listener
        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space') {
                event.preventDefault();
                attemptFire();
            }
        });
        
        // Update status every 100ms
        setInterval(updateStatus, 100);
        
        // Initialize
        updateStatus();
        log('üöÄ Simple weapons test initialized', 'success');
        log('Press SPACEBAR or click Fire button to test weapons', 'info');
        log('Normal cooldown: 500ms between shots', 'info');
        
        // Make objects available in console for debugging
        window.testWeapon = weapon;
        window.testShip = ship;
    </script>
</body>
</html> 