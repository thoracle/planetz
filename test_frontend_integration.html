<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission System Integration Test</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff41;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .test-section {
            border: 1px solid #00ff41;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .test-result {
            margin: 5px 0;
            padding: 5px;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }
        button {
            background: #004400;
            color: #00ff41;
            border: 1px solid #00ff41;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 3px;
        }
        button:hover {
            background: #006600;
        }
        .log-area {
            background: #111;
            border: 1px solid #333;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Mission System Integration Test</h1>
        <p>Testing the mission system integration between frontend and backend</p>
        
        <div class="test-section">
            <h2>Backend Connection Test</h2>
            <button onclick="testBackendConnection()">Test Backend Connection</button>
            <div id="connection-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Mission Event Service Test</h2>
            <button onclick="testCargoLoadedEvent()">Test Cargo Loaded Event</button>
            <button onclick="testAutoDeliveryEvent()">Test Auto-Delivery Event</button>
            <button onclick="testMarketSaleEvent()">Test Market-Sale Event</button>
            <div id="event-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Mission API Tests</h2>
            <button onclick="testMissionAPIs()">Test All Mission APIs</button>
            <div id="api-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Test Log</h2>
            <button onclick="clearLog()">Clear Log</button>
            <div id="test-log" class="log-area"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';
        let testResults = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logArea = document.getElementById('test-log');
            const prefix = {
                'success': '‚úÖ',
                'error': '‚ùå', 
                'warning': '‚ö†Ô∏è',
                'info': '‚ÑπÔ∏è'
            }[type] || '‚ÑπÔ∏è';
            
            logArea.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('test-log').textContent = '';
        }
        
        async function testBackendConnection() {
            const resultDiv = document.getElementById('connection-result');
            log('Testing backend connection...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/missions/stats`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = '<div class="success">‚úÖ Backend connected successfully</div>';
                    log(`Backend connected: ${JSON.stringify(data)}`, 'success');
                    return true;
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå Backend error: ' + response.status + '</div>';
                    log(`Backend error: ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="error">‚ùå Connection failed: ' + error.message + '</div>';
                log(`Connection failed: ${error.message}`, 'error');
                return false;
            }
        }
        
        async function testCargoLoadedEvent() {
            log('Testing cargo loaded event...', 'info');
            
            const eventData = {
                cargo_type: 'medical_supplies',
                quantity: 50,
                location: 'terra_prime',
                player_context: {
                    player_ship: 'starter_ship',
                    timestamp: Date.now()
                }
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/missions/events/cargo_loaded`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(eventData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    log(`Cargo loaded event successful: ${result.count} missions updated`, 'success');
                    document.getElementById('event-result').innerHTML += 
                        '<div class="success">‚úÖ Cargo loaded event processed</div>';
                } else {
                    log(`Cargo loaded event failed: ${result.error}`, 'error');
                    document.getElementById('event-result').innerHTML += 
                        '<div class="error">‚ùå Cargo loaded event failed</div>';
                }
            } catch (error) {
                log(`Cargo loaded event error: ${error.message}`, 'error');
            }
        }
        
        async function testAutoDeliveryEvent() {
            log('Testing auto-delivery event...', 'info');
            
            const eventData = {
                cargo_type: 'medical_supplies',
                quantity: 50,
                delivery_location: 'europa_research_station',
                location: 'europa_research_station',
                integrity: 0.95,
                source: 'docking',
                player_context: {
                    player_ship: 'starter_ship',
                    timestamp: Date.now()
                }
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/missions/events/cargo_delivered`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(eventData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    log(`Auto-delivery event successful: ${result.count} missions updated`, 'success');
                    document.getElementById('event-result').innerHTML += 
                        '<div class="success">‚úÖ Auto-delivery event processed</div>';
                } else {
                    log(`Auto-delivery event failed: ${result.error}`, 'error');
                    document.getElementById('event-result').innerHTML += 
                        '<div class="error">‚ùå Auto-delivery event failed</div>';
                }
            } catch (error) {
                log(`Auto-delivery event error: ${error.message}`, 'error');
            }
        }
        
        async function testMarketSaleEvent() {
            log('Testing market-sale event...', 'info');
            
            const eventData = {
                cargo_type: 'luxury_goods',
                quantity: 25,
                delivery_location: 'ceres_outpost',
                location: 'ceres_outpost',
                integrity: 0.98,
                source: 'market',
                player_context: {
                    player_ship: 'starter_ship',
                    timestamp: Date.now()
                }
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/missions/events/cargo_delivered`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(eventData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    log(`Market-sale event successful: ${result.count} missions updated`, 'success');
                    document.getElementById('event-result').innerHTML += 
                        '<div class="success">‚úÖ Market-sale event processed</div>';
                } else {
                    log(`Market-sale event failed: ${result.error}`, 'error');
                    document.getElementById('event-result').innerHTML += 
                        '<div class="error">‚ùå Market-sale event failed</div>';
                }
            } catch (error) {
                log(`Market-sale event error: ${error.message}`, 'error');
            }
        }
        
        async function testMissionAPIs() {
            log('Testing all mission APIs...', 'info');
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '';
            
            const endpoints = [
                { url: '/api/missions/available', name: 'Available Missions' },
                { url: '/api/missions/active', name: 'Active Missions' },
                { url: '/api/missions/stats', name: 'Mission Stats' }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(`${API_BASE}${endpoint.url}`);
                    const data = await response.json();
                    
                    if (response.ok) {
                        resultDiv.innerHTML += `<div class="success">‚úÖ ${endpoint.name}: OK</div>`;
                        log(`${endpoint.name} API: OK`, 'success');
                    } else {
                        resultDiv.innerHTML += `<div class="error">‚ùå ${endpoint.name}: ${response.status}</div>`;
                        log(`${endpoint.name} API: ${response.status}`, 'error');
                    }
                } catch (error) {
                    resultDiv.innerHTML += `<div class="error">‚ùå ${endpoint.name}: ${error.message}</div>`;
                    log(`${endpoint.name} API: ${error.message}`, 'error');
                }
            }
        }
        
        // Run initial connection test
        window.addEventListener('load', () => {
            log('Mission System Integration Test loaded', 'info');
            testBackendConnection();
        });
    </script>
</body>
</html>
