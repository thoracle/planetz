<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Tooltip Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #00ff00;
            padding: 20px;
        }
        .instructions {
            background: #111;
            padding: 15px;
            border: 1px solid #333;
            margin-bottom: 20px;
        }
        .status {
            background: #002200;
            padding: 10px;
            border: 1px solid #00ff00;
            margin-bottom: 20px;
        }
        .debug-output {
            background: #001100;
            padding: 10px;
            border: 1px solid #006600;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background: #003300;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #006600;
        }
    </style>
</head>
<body>
    <h1>üéØ Star Charts Tooltip Fix Test</h1>
    
    <div class="instructions">
        <h3>Instructions:</h3>
        <ol>
            <li>Open the main game in another tab: <a href="/" target="_blank" style="color: #00ff00;">Open Game</a></li>
            <li>Press 'C' to open Star Charts</li>
            <li>Hover over objects immediately (without clicking first)</li>
            <li>Check if tooltips show names right away</li>
            <li>Use the debug script below if needed</li>
        </ol>
    </div>
    
    <div class="status">
        <h3>Expected Behavior:</h3>
        <ul>
            <li>‚úÖ Tooltips should show object names immediately on hover</li>
            <li>‚úÖ No "empty" tooltips or undefined names</li>
            <li>‚úÖ No JavaScript errors in console</li>
            <li>‚úÖ Fallback names for objects without database entries</li>
        </ul>
    </div>
    
    <h3>Debug Tools:</h3>
    <button onclick="copyDebugScript()">Copy Debug Script to Clipboard</button>
    <button onclick="showDebugScript()">Show Debug Script</button>
    <button onclick="clearOutput()">Clear Output</button>
    
    <div class="debug-output" id="debugOutput">
        <p>Debug output will appear here...</p>
    </div>
    
    <script>
        const debugScript = `
// Debug script for tooltip issue - paste this in browser console
console.log('üîß Starting tooltip debug session...');

if (window.navigationSystemManager && window.navigationSystemManager.starChartsUI) {
    const starChartsUI = window.navigationSystemManager.starChartsUI;
    const starChartsManager = window.navigationSystemManager.starChartsManager;
    
    console.log('‚úÖ Star Charts UI found');
    console.log('‚úÖ Star Charts Manager found');
    
    // Check object database
    console.log('üìä Object Database Status:', {
        hasDatabase: !!starChartsManager.objectDatabase,
        isInitialized: !!starChartsManager.isInitialized,
        currentSector: starChartsManager.currentSector
    });
    
    // Check available objects
    const allObjects = starChartsUI.getDiscoveredObjectsForRender();
    console.log('üåü Available Objects:', {
        count: allObjects.length,
        objects: allObjects.map(obj => ({
            id: obj.id,
            name: obj.name,
            type: obj.type,
            _isUndiscovered: obj._isUndiscovered
        }))
    });
    
    // Test ensureObjectHasName for each object
    console.log('üîç Testing ensureObjectHasName for each object:');
    allObjects.forEach((obj, index) => {
        const completeObj = starChartsUI.ensureObjectHasName(obj);
        console.log(\`  \${index + 1}. \${obj.id}:\`, {
            originalName: obj.name,
            completeName: completeObj?.name,
            completeType: completeObj?.type,
            success: !!completeObj?.name
        });
    });
    
    console.log('‚úÖ Debug complete. Now test hovering over objects!');
    
} else {
    console.log('‚ùå Star Charts not found. Make sure to:');
    console.log('  1. Open the game');
    console.log('  2. Press "C" to open Star Charts');
    console.log('  3. Wait for initialization');
    console.log('  4. Run this script again');
}
        `;
        
        function copyDebugScript() {
            navigator.clipboard.writeText(debugScript).then(() => {
                addOutput('‚úÖ Debug script copied to clipboard! Paste it in the browser console.');
            }).catch(() => {
                addOutput('‚ùå Failed to copy. Use the "Show Debug Script" button instead.');
            });
        }
        
        function showDebugScript() {
            addOutput('üìã Debug Script:');
            addOutput(debugScript);
        }
        
        function clearOutput() {
            document.getElementById('debugOutput').innerHTML = '<p>Debug output cleared...</p>';
        }
        
        function addOutput(text) {
            const output = document.getElementById('debugOutput');
            const p = document.createElement('p');
            p.textContent = text;
            output.appendChild(p);
            output.scrollTop = output.scrollHeight;
        }
        
        // Add some helpful info on load
        addOutput('üéØ Tooltip Fix Test Page Loaded');
        addOutput('üí° Use the buttons above to get debug tools');
        addOutput('üîß The fix includes:');
        addOutput('  - ensureObjectHasName() method for robust name resolution');
        addOutput('  - Fallback name generation from object IDs');
        addOutput('  - Better database lookup with error handling');
        addOutput('  - Enhanced debugging output');
    </script>
</body>
</html>
